# =======================================================================
# Goal driven Parallel Sequences
# See https://www.sciencedirect.com/science/article/pii/S1532046421000794
# and https://github.com/hongsun502/wstLogic/tree/master
# =======================================================================

@prefix math: <http://www.w3.org/2000/10/swap/math#>.
@prefix list: <http://www.w3.org/2000/10/swap/list#>.
@prefix gps:  <https://eyereasoner.github.io/eye/reasoning/gps/gps-schema#>.
@prefix :     <https://eyereasoner.github.io/eye/reasoning#>.

# current state
:i1 :location :Gent.

# -------------------------------------------------
# map of Belgium (as backward rules / descriptions)
# -------------------------------------------------
{:map-BE gps:description ({?S :location :Gent}     true {?S :location :Brugge}   :drive_gent_brugge      1500.0 0.006 0.96 0.99)} <= true.
{:map-BE gps:description ({?S :location :Gent}     true {?S :location :Kortrijk} :drive_gent_kortrijk    1600.0 0.007 0.96 0.99)} <= true.
{:map-BE gps:description ({?S :location :Kortrijk} true {?S :location :Brugge}   :drive_kortrijk_brugge  1600.0 0.007 0.96 0.99)} <= true.
{:map-BE gps:description ({?S :location :Brugge}   true {?S :location :Oostende} :drive_brugge_oostende   900.0 0.004 0.98 1.0 )} <= true.

# -----------------------------
# Compute all paths by chaining
# -----------------------------
# Base: a single map description is a path
{
  (?From ?To (?Act) ?Dur ?Cost ?Belief ?Comfort) :path true.
}
<=
{
  :map-BE gps:description (?From true ?To ?Act ?Dur ?Cost ?Belief ?Comfort).
}.

# Recursive: chain one step + rest path, and aggregate weights
{
  (?From ?To ?Actions ?Dur ?Cost ?Belief ?Comfort) :path true.
}
<=
{
  :map-BE gps:description (?From true ?Mid ?Act ?Dur1 ?Cost1 ?Bel1 ?Comf1).
  (?Mid ?To ?RestActs ?Dur2 ?Cost2 ?Bel2 ?Comf2) :path true.

  ((?Act) ?RestActs) list:append ?Actions.

  (?Dur1  ?Dur2)  math:sum     ?Dur.
  (?Cost1 ?Cost2) math:sum     ?Cost.
  (?Bel1  ?Bel2)  math:product ?Belief.
  (?Comf1 ?Comf2) math:product ?Comfort.
}.

# ------------------------------------------------------
# "Query": derive gps:path facts for i1, goal = Oostende
# ------------------------------------------------------
{
  :i1 :location :Gent.
  ({:i1 :location :Gent} {:i1 :location :Oostende} ?Acts ?Dur ?Cost ?Bel ?Comf) :path true.
}
=>
{
  :i1 gps:path (?Acts ?Dur ?Cost ?Bel ?Comf).
}.

